## Distro

Windows Server 2019


## GSSAPI Impl

SSPI


## Connection Info:

Connecting to host using FQDN with explicit credentials with an SPN that is invalid.


## Notes

* The session key for this scenario was `l3pcY7rE3QlK77m2/xUXsQ==` - password was `VagrantPass1`


## Tokens

```yaml
MessageType: NtlmNegotiate (1)
Signature: "NTLMSSP\0"
Data:
  NegotiateFlagsRaw: 3792208567
  NegotiateFlags:
  - NTLMSSP_NEGOTIATE_56 (2147483648)
  - NTLMSSP_NEGOTIATE_KEY_EXCH (1073741824)
  - NTLMSSP_NEGOTIATE_128 (536870912)
  - NTLMSSP_NEGOTIATE_VERSION (33554432)
  - NTLMSSP_NEGOTIATE_EXTENDED_SESSIONSECURITY (524288)
  - NTLMSSP_NEGOTIATE_ALWAYS_SIGN (32768)
  - NTLMSSP_NEGOTIATE_NTLM (512)
  - NTLMSSP_NEGOTIATE_LM_KEY (128)
  - NTLMSSP_NEGOTIATE_SEAL (32)
  - NTLMSSP_NEGOTIATE_SIGN (16)
  - NTLMSSP_REQUEST_TARGET (4)
  - NTLMSSP_NEGOTIATE_OEM (2)
  - NTLMSSP_NEGOTIATE_UNICODE (1)
  DomainName:
  Workstation:
  Version:
    Major: 10
    Minor: 0
    Build: 17763
    Reserved: '000000'
    NTLMRevision: 15
RawData: 4E544C4D5353500001000000B78208E2000000000000000000000000000000000A0063450000000F
```

```yaml
MessageType: NtlmChallenge (2)
Signature: "NTLMSSP\0"
Data:
  NegotiateFlagsRaw: 3800662581
  NegotiateFlags:
  - NTLMSSP_NEGOTIATE_56 (2147483648)
  - NTLMSSP_NEGOTIATE_KEY_EXCH (1073741824)
  - NTLMSSP_NEGOTIATE_128 (536870912)
  - NTLMSSP_NEGOTIATE_VERSION (33554432)
  - NTLMSSP_NEGOTIATE_TARGET_INFO (8388608)
  - NTLMSSP_NEGOTIATE_EXTENDED_SESSIONSECURITY (524288)
  - NTLMSSP_TARGET_TYPE_DOMAIN (65536)
  - NTLMSSP_NEGOTIATE_ALWAYS_SIGN (32768)
  - NTLMSSP_NEGOTIATE_NTLM (512)
  - NTLMSSP_NEGOTIATE_SEAL (32)
  - NTLMSSP_NEGOTIATE_SIGN (16)
  - NTLMSSP_REQUEST_TARGET (4)
  - NTLMSSP_NEGOTIATE_UNICODE (1)
  TargetName: DOMAIN
  ServerChallenge: 96E5D24791C91A89
  Reserved: '0000000000000000'
  TargetInfo:
  - AvId: MSV_AV_NB_DOMAIN_NAME (2)
    Value: DOMAIN
  - AvId: MSV_AV_NB_COMPUTER_NAME (1)
    Value: DC01
  - AvId: MSV_AV_DNS_DOMAIN_NAME (4)
    Value: domain.local
  - AvId: MSV_AV_DNS_COMPUTER_NAME (3)
    Value: DC01.domain.local
  - AvId: MSV_AV_DNS_TREE_NAME (5)
    Value: domain.local
  - AvId: MSV_AV_TIMESTAMP (7)
    Value: '2020-05-07T10:44:56.9362104Z'
  - AvId: MSV_AV_EOL (0)
    Value:
  Version:
    Major: 10
    Minor: 0
    Build: 14393
    Reserved: '000000'
    NTLMRevision: 15
RawData: 4E544C4D53535000020000000C000C0038000000358289E296E5D24791C91A8900000000000000008A008A00440000000A0039380000000F44004F004D00410049004E0002000C0044004F004D00410049004E000100080044004300300031000400180064006F006D00610069006E002E006C006F00630061006C000300220044004300300031002E0064006F006D00610069006E002E006C006F00630061006C000500180064006F006D00610069006E002E006C006F00630061006C0007000800B81EA78C5C24D60100000000
```

```yaml
MessageType: NtlmAuthenticate (3)
Signature: "NTLMSSP\0"
Data:
  NegotiateFlagsRaw: 3800597045
  NegotiateFlags:
  - NTLMSSP_NEGOTIATE_56 (2147483648)
  - NTLMSSP_NEGOTIATE_KEY_EXCH (1073741824)
  - NTLMSSP_NEGOTIATE_128 (536870912)
  - NTLMSSP_NEGOTIATE_VERSION (33554432)
  - NTLMSSP_NEGOTIATE_TARGET_INFO (8388608)
  - NTLMSSP_NEGOTIATE_EXTENDED_SESSIONSECURITY (524288)
  - NTLMSSP_NEGOTIATE_ALWAYS_SIGN (32768)
  - NTLMSSP_NEGOTIATE_NTLM (512)
  - NTLMSSP_NEGOTIATE_SEAL (32)
  - NTLMSSP_NEGOTIATE_SIGN (16)
  - NTLMSSP_REQUEST_TARGET (4)
  - NTLMSSP_NEGOTIATE_UNICODE (1)
  LmChallengeResponse:
    ResponseType: LMv1
    LMProofStr: '000000000000000000000000000000000000000000000000'
  NtChallengeResponse:
    ResponseType: NTLMv2
    NTProofStr: 1C0AD221C756F5E5EF7AB1F4A6142F80
    ClientChallenge:
      RespType: 1
      HiRespType: 1
      Reserved1: 0
      Reserved2: 0
      TimeStamp: '2020-05-07T10:44:56.9362104Z'
      ChallengeFromClient: 5C37F5C980152445
      Reserved3: 0
      AvPairs:
      - AvId: MSV_AV_NB_DOMAIN_NAME (2)
        Value: DOMAIN
      - AvId: MSV_AV_NB_COMPUTER_NAME (1)
        Value: DC01
      - AvId: MSV_AV_DNS_DOMAIN_NAME (4)
        Value: domain.local
      - AvId: MSV_AV_DNS_COMPUTER_NAME (3)
        Value: DC01.domain.local
      - AvId: MSV_AV_DNS_TREE_NAME (5)
        Value: domain.local
      - AvId: MSV_AV_TIMESTAMP (7)
        Value: '2020-05-07T10:44:56.9362104Z'
      - AvId: MSV_AV_FLAGS (6)
        Value:
        - MIC_PROVIDED (2)
      - AvId: MSV_AV_SINGLE_HOST (8)
        Value:
          Size: 48
          Z4: 0
          CustomData: '0100000000200000'
          MachineId: 4135E6AB9D279B8D0642C048E0C1F24D0A9017A55C35B1A184872FEDFA712BDC
      - AvId: MSV_AV_CHANNEL_BINDINGS (10)
        Value: '00000000000000000000000000000000'
      - AvId: MSV_AV_TARGET_NAME (9)
        Value: SERV\fake
      - AvId: MSV_AV_EOL (0)
        Value:
      Reserved4: 0
  DomainName:
  UserName: vagrant-domain@DOMAIN.LOCAL
  Workstation: SERVER2019
  EncryptedRandomSessionKey: 89253B3EBB43F7E3E6B51F6264806022
  Version:
    Major: 10
    Minor: 0
    Build: 17763
    Reserved: '000000'
    NTLMRevision: 15
  MIC: B9E0D5D61693A4A69EE5073DDDB0CE55
  SessionKey: 977A5C63BAC4DD094AEFB9B6FF1517B1
RawData: 4E544C4D535350000300000018001800A200000020012001BA00000000000000580000003600360058000000140014008E00000010001000DA010000358288E20A0063450000000FB9E0D5D61693A4A69EE5073DDDB0CE55760061006700720061006E0074002D0064006F006D00610069006E00400044004F004D00410049004E002E004C004F00430041004C0053004500520056004500520032003000310039000000000000000000000000000000000000000000000000001C0AD221C756F5E5EF7AB1F4A6142F800101000000000000B81EA78C5C24D6015C37F5C9801524450000000002000C0044004F004D00410049004E000100080044004300300031000400180064006F006D00610069006E002E006C006F00630061006C000300220044004300300031002E0064006F006D00610069006E002E006C006F00630061006C000500180064006F006D00610069006E002E006C006F00630061006C0007000800B81EA78C5C24D601060004000200000008003000300000000000000001000000002000004135E6AB9D279B8D0642C048E0C1F24D0A9017A55C35B1A184872FEDFA712BDC0A001000000000000000000000000000000000000900120053004500520056005C00660061006B006500000000000000000089253B3EBB43F7E3E6B51F6264806022
```
